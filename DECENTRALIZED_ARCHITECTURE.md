# QUIVer 完全分散型P2Pアーキテクチャ

## 概要

QUIVerは中央管理サーバーを必要としない完全分散型のP2P AIネットワークです。各ノードは独立して動作し、ネットワークは無限にスケールできます。

## 主要コンポーネント

### 1. DHT (分散ハッシュテーブル)
- **Kademlia DHT**を使用してピア発見を実現
- 中央サーバーなしでノードが互いを見つけられる
- 自動的に最適なルーティングテーブルを構築

### 2. GossipSub プロトコル
- 効率的なメッセージブロードキャスト
- 推論リクエストと結果の配信
- ノード情報の定期的な共有

### 3. レピュテーションシステム
- 各ノードの信頼性を追跡
- 成功率、応答時間、稼働時間を考慮
- 悪意のあるノードを自動的に排除

## 動作の仕組み

### ノードの起動
```bash
# 最初のノード（ブートストラップノード）
./quiver-node --bootstrap-node --port 4001

# 追加ノード（既存ネットワークに参加）
./quiver-node --bootstrap /ip4/192.168.1.100/tcp/4001/p2p/QmNodeID
```

### ピア発見プロセス
1. 新しいノードがブートストラップピアに接続
2. DHTを通じて他のノードを発見
3. 自動的にルーティングテーブルを構築
4. 定期的に新しいピアを探索

### 推論リクエストフロー
1. クライアントが推論リクエストを送信
2. GossipSubでネットワーク全体にブロードキャスト
3. 利用可能なノードが処理を実行
4. 最初の有効な結果をクライアントに返送

## スケーラビリティ

### 無限のスケール
- ノード数に理論的な上限なし
- 各ノードは限られた数のピアとのみ直接接続
- DHTにより効率的なルーティングを実現

### 負荷分散
- レピュテーションベースのノード選択
- CPU使用率を考慮した自動負荷分散
- 応答時間の最適化

## セキュリティ

### 暗号化通信
- TLS 1.3による全通信の暗号化
- Ed25519署名による認証
- 中間者攻撃の防止

### Sybil攻撃対策
- レピュテーションシステムによる信頼性評価
- 新規ノードの段階的な信頼構築
- 異常な振る舞いの自動検出

## 耐障害性

### 単一障害点なし
- 中央サーバーが存在しない
- 任意のノードが離脱しても継続動作
- 自動的な再ルーティング

### データ冗長性
- 重要な情報は複数ノードに分散保存
- 自動レプリケーション
- ノード障害時の自動復旧

## 実装例

### 基本的なノードの起動
```go
cfg := &p2p.NodeConfig{
    ListenAddrs: []string{
        "/ip4/0.0.0.0/tcp/0",
        "/ip4/0.0.0.0/udp/0/quic",
    },
    BootstrapPeers: []string{
        "/dnsaddr/bootstrap.quiver.network/p2p/QmBootstrapNode",
    },
}

node, err := p2p.NewDecentralizedNode(cfg)
if err != nil {
    log.Fatal(err)
}
defer node.Close()
```

### 推論リクエストの送信
```go
result, err := node.SendInferenceRequest(
    "llama3.2",           // モデル名
    "Hello, world!",      // プロンプト
    100,                  // 最大トークン数
)
```

## ネットワーク参加方法

### 1. プロバイダーとして参加
```bash
# QUIVer Providerをダウンロード
curl -fsSL https://raw.githubusercontent.com/yukihamada/quiver/main/install.sh | bash

# 起動（自動的にネットワークを発見）
quiver-provider start
```

### 2. 独自ブートストラップノードの運用
```bash
# 専用ポートで起動
quiver-provider --bootstrap-node --port 4001

# 他のノードはこのアドレスを使って接続
quiver-provider --bootstrap your-server.com:4001
```

## パフォーマンス

### ネットワーク効率
- O(log N) のルーティング複雑度
- 最小限のネットワークオーバーヘッド
- 適応的なピア選択

### 推論パフォーマンス
- 最も近い/最速のノードを自動選択
- 並列処理による高速化
- キャッシングによる応答時間短縮

## まとめ

QUIVerの完全分散型アーキテクチャにより：
- ✅ 中央サーバー不要
- ✅ 無限にスケール可能
- ✅ 高い耐障害性
- ✅ プライバシー保護
- ✅ 検閲耐性

これにより、真に分散化されたAI推論ネットワークを実現します。